# Access rules define how Oathkeeper routes and authenticates requests.
# Public routes use anonymous authenticator, private routes require valid Kratos session.
# See: https://www.ory.sh/docs/oathkeeper/reference/access-rules

- id: public-api
  match:
    url: <http|https>://<[^/]+>/api/public/<.*>
    methods: ["GET", "OPTIONS"]
  authenticators:
    - handler: anonymous
  authorizer:
    handler: allow
  mutators:
    - handler: noop
  upstream:
    url: http://backend:8080/api/public
    strip_path: /api/public

- id: private-api
  match:
    url: <http|https>://<[^/]+>/api/private/<.*>
    methods: ["GET", "POST", "DELETE", "OPTIONS"]
  authenticators:
    - handler: cookie_session
  authorizer:
    handler: allow
  mutators:
    - handler: header
      config:
        headers:
          X-User-Id: '{{ print .Subject }}'
  upstream:
    url: http://backend:8080/api/private
    strip_path: /api/private

